USE Brandi_Ficha_Tecnica;

-- Tabela provis√≥ria, vamos usar a tabela do grupo B das roles
CREATE TABLE Coordenador (
ID_Coordenador INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
Pessoa INT
);

CREATE TABLE Cliente (
	ID_Cliente INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
	Contacto NVARCHAR(50) NOT NULL,
	Nome NVARCHAR(100) NOT NULL,
	Email NVARCHAR(50) NOT NULL,
	Morada NVARCHAR(100) NOT NULL,
	NIF NVARCHAR(11) NOT NULL
);

CREATE TABLE Pedido (
	ID_Pedido INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
    Titulo NVARCHAR(100) NOT NULL,  
	Time_Stamp DATE NOT NULL,
    Foto BLOB NULL,
	Cliente INT UNSIGNED NOT NULL,
	CONSTRAINT FK_Cliente FOREIGN KEY (Cliente) REFERENCES Cliente(ID_Cliente) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE Proposta (
	ID_Proposta INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
    Descricao_da_Proposta NVARCHAR(255) NULL,  
	Data_da_proposta DATE NOT NULL,
    Aceita NVARCHAR(4) NULL,
	Razao_da_Recusa NVARCHAR(255) NULL,
	Pedido INT UNSIGNED NOT NULL,
	Coordenador INT UNSIGNED NOT NULL,	
	CONSTRAINT FK_Pedido FOREIGN KEY (Pedido) REFERENCES Pedido(ID_Pedido) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE Conversa (
	ID_Conversa INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
    Resposta NVARCHAR(255) NULL,  
	Time_Stamp DATE NOT NULL,
	Pedido INT UNSIGNED NOT NULL,
	CONSTRAINT FK_Pedido_Conversa FOREIGN KEY (Pedido) REFERENCES Pedido(ID_Pedido) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE Conversa_Coordenador (
	ID_Conversa INT UNSIGNED NOT NULL,
    ID_Coordenador INT UNSIGNED NOT NULL,
    PRIMARY KEY(ID_Conversa, ID_Coordenador),
    CONSTRAINT FK_Coordenador_ID_Conversa FOREIGN KEY (ID_Conversa) REFERENCES Conversa(ID_Conversa) ON UPDATE CASCADE ON DELETE CASCADE,
    CONSTRAINT FK_Conversa_ID_Coordenador FOREIGN KEY (ID_Coordenador) REFERENCES Coordenador(ID_Coordenador) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE Despesas (
	ID_Despesas INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
    Extras NVARCHAR(255) NULL, 
	Km_deslocacao INT NULL, 	
	Tempo_Analise INT NULL,
	Pedido INT UNSIGNED NOT NULL,
	CONSTRAINT FK_Despesas_Pedido FOREIGN KEY (Pedido) REFERENCES Pedido(ID_Pedido) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE Analise (
	ID_Analise INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
    Descricao_da_Analise NVARCHAR(255) NULL, 
	Time_Stamp DATE NULL,	
	Pedido INT UNSIGNED NOT NULL,
	Coordenador INT UNSIGNED NOT NULL,
	CONSTRAINT FK_Analise_Pedido FOREIGN KEY (Pedido) REFERENCES Pedido(ID_Pedido) ON UPDATE CASCADE ON DELETE CASCADE,
	CONSTRAINT FK_Analise_Coordenador FOREIGN KEY (Coordenador) REFERENCES Coordenador(ID_Coordenador) ON UPDATE CASCADE ON DELETE CASCADE
);
